/* 
	jQuery Googlemap Plugin - v1.0	 
	Copyright Â© 2011 Daniel Thomson
	
	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php
*/

(function(e){e.fn.MapMe=function(d){var a=e.extend(true,{},{mapCanvas:"mapPane",pinCenter:true,trackLocation:true,trackingPeriod:false,trackingCircle:true,centerMarker:{},markerCluster:false,markerClusterOptions:{styles:[{height:53,width:53,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m1.png",textColor:"#000",textSize:16},{height:56,width:56,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m2.png",textColor:"#000", textSize:16},{height:66,width:66,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m3.png",textColor:"#000",textSize:16},{height:78,width:78,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m4.png",textColor:"#000",textSize:16},{height:90,width:90,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m5.png",textColor:"#000",textSize:16}],minimumClusterSize:3},customPins:{myCustomPin:{pinImg:"img/pin.png", pinImgSize:[36,55],pinOrigin:[0,0],pinAnchor:[18,55],pinShape:{coord:[1,1,1,36,55,36,55,1],type:"poly"},pinShadow:"img/pin-shadow.png",pinShadowSize:[77,58],pinShadowOrigin:[0,0],pinShadowAnchor:[22,55]}},markers:[],mapOptions:{zoom:12,center:[80,80],mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,panControl:false,zoomControl:true,scaleControl:true,streetViewControl:true,overviewMapControl:true}},d);this.each(function(){a.mapOptions.center=new google.maps.LatLng(a.mapOptions.center[0], a.mapOptions.center[1]);var b=new google.maps.Map(document.getElementById(a.mapCanvas),a.mapOptions),c,d;if(a.trackLocation===true)e.fn.MapMe.getUserPosition(b,a);else if(a.pinCenter===true)c=[a.mapOptions.center.Oa,a.mapOptions.center.Pa],b.centerMarker=e.fn.MapMe.addCentrePin(b,a,c);c=e.fn.MapMe.setMarkers(b,a);if(typeof MarkerClusterer!=="undefined"&&a.markerCluster===true)d=a.markerClusterOptions,new MarkerClusterer(b,c,d);a.trackLocation&&a.trackingPeriod&&setTimeout(function(){e.fn.MapMe.updateLocation(b, a)},a.trackingPeriod)});return this};e.fn.MapMe.getUserPosition=function(d,a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){e.fn.MapMe.geoSuccess(d,a,[b.coords.latitude,b.coords.longitude])},function(){e.fn.MapMe.geoFailure()},{timeout:a.trackingPeriod}):google.gears?google.gears.factory.create("beta.geolocation").getCurrentPosition(function(b){e.fn.MapMe.geoSuccess(d,a,[b.latitude,b.longitude])},function(){e.fn.MapMe.geoFailure()},{timeout:a.trackingPeriod}):e.fn.MapMe.geoFailure()}; e.fn.MapMe.geoSuccess=function(d,a,b){var c=new google.maps.LatLng(b[0],b[1]);d.centerSet||d.setCenter(c);d.centerSet=true;if(a.pinCenter===true){d.centerMarker&&(d.centerMarker.setMap(null),d.centerOverlay.setMap(null));if(a.trackLocation===true)a.centerMarker.lat=b[1],a.centerMarker.lng=b[0];d.centerMarker=e.fn.MapMe.addCentrePin(d,a,b)}};e.fn.MapMe.geoFailure=function(){};e.fn.MapMe.updateLocation=function(d,a){e.fn.MapMe.getUserPosition(d,a);setTimeout(function(){e.fn.MapMe.updateLocation(d,a)}, a.trackingPeriod)};e.fn.MapMe.setMarkers=function(d,a){var b=a.markers,c=[],h=b.length,f,g,i,j,k;if(h>0)for(f=0;f<h;f+=1)g=b[f],i=b[f].infoWindow,j=b[f].pinEvent,b[f].pin?g=e.fn.MapMe.customPin(d,a,g):(k=new google.maps.LatLng(g.lat,g.lng),g=new google.maps.Marker({position:k,map:d,title:g.title})),i&&e.fn.MapMe.addInfoWindow(d,g,i),j&&e.fn.MapMe.addPinEvents(j,g),c.push(g);return c};e.fn.MapMe.addCentrePin=function(d,a,b){var c;c={};var h;a.centerMarker.pin?(c.lat=b[0],c.lng=b[1],c.title=a.centerMarker.title, c.pin=a.centerMarker.pin,c=e.fn.MapMe.customPin(d,a,c)):(c=new google.maps.Marker({position:new google.maps.LatLng(b[0],b[1]),title:a.centerMarker.title,map:d}),c.setMap(d));(h=a.centerMarker.infoWindow)&&e.fn.MapMe.addInfoWindow(d,a,c,h);b={strokeColor:"#4d9cff",strokeOpacity:0.4,strokeWeight:2,fillColor:"#4d9cff",fillOpacity:0.15,map:d,center:new google.maps.LatLng(b[0],b[1]),radius:200};if(a.trackingCircle===true)d.centerOverlay=new google.maps.Circle(b);return c};e.fn.MapMe.customPin=function(d, a,b){var c=b.pin,e,f;a.customPins[c]||alert("custom pin has not been defined properly");e=new google.maps.MarkerImage(a.customPins[c].pinImg,new google.maps.Size(a.customPins[c].pinImgSize[0],a.customPins[c].pinImgSize[1]),new google.maps.Point(a.customPins[c].pinOrigin[0],a.customPins[c].pinOrigin[1]),new google.maps.Point(a.customPins[c].pinAnchor[0],a.customPins[c].pinAnchor[1]));f=new google.maps.MarkerImage(a.customPins[c].pinShadow,new google.maps.Size(a.customPins[c].pinShadowSize[0],a.customPins[c].pinShadowSize[1]), new google.maps.Point(a.customPins[c].pinShadowOrigin[0],a.customPins[c].pinShadowOrigin[1]),new google.maps.Point(a.customPins[c].pinShadowAnchor[0],a.customPins[c].pinShadowAnchor[1]));(a=a.customPins[c].pinShape)||(a="");c=new google.maps.LatLng(b.lat,b.lng);return new google.maps.Marker({position:c,map:d,shadow:f,icon:e,shape:a,title:b.title})};e.fn.MapMe.addPinEvents=function(d,a){var b,c;for(c in d)b=d[c],google.maps.event.addListener(a,c,b)};e.fn.MapMe.addInfoWindow=function(d,a,b){b=new google.maps.InfoWindow({content:b}); google.maps.event.addListener(a,"click",function(){b.open(d,a)})}})(jQuery);