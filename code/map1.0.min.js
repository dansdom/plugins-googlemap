/* 
	jQuery Googlemap Plugin - v1.0 
	Copyright (c) 2011 Daniel Thomson
	
	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php
*/

(function(e){e.fn.MapMe=function(d){var a=e.extend(!0,{},{mapCanvas:"mapPane",mapCenter:[80,80],pinCenter:!0,centerMarker:[],markerCluster:!1,markerClusterOptions:{styles:[{height:53,width:53,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m1.png",textColor:"#000",textSize:16},{height:56,width:56,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m2.png",textColor:"#000",textSize:16},{height:66,width:66,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m3.png", textColor:"#000",textSize:16},{height:78,width:78,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m4.png",textColor:"#000",textSize:16},{height:90,width:90,url:"http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m5.png",textColor:"#000",textSize:16}],gridSize:60,minimumClusterSize:3},customPins:{myCustomPin:{pinImg:"img/pin.png",pinImgSize:[36,55],pinOrigin:[0,0],pinAnchor:[18,55],pinShape:{coord:[1,1,1,36,55,36,55,1],type:"poly"}, pinShadow:"img/pin-shadow.png",pinShadowSize:[77,58],pinShadowOrigin:[0,0],pinShadowAnchor:[22,55]}},markers:[],mapOptions:{zoom:10,center:"80, 80",mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,panControl:!1,zoomControl:!0,scaleControl:!0,streetViewControl:!0,overviewMapControl:!0}},d);this.each(function(){if(a.mapCenter=="current")a.mapCenter=e.fn.MapMe.getCurrentPosition();a.mapOptions.center=new google.maps.LatLng(a.mapCenter[0],a.mapCenter[1]);var c=new google.maps.Map(document.getElementById(a.mapCanvas), a.mapOptions),b=e.fn.MapMe.setMarkers(c,a);a.markerCluster==!0&&typeof MarkerClusterer!=="undefined"&&new MarkerClusterer(c,b,a.markerClusterOptions)});return this};e.fn.MapMe.getCurrentPosition=function(){var d=[];navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){d=[a.coords.latitude,a.coords.longitude]}):google.gears?google.gears.factory.create("beta.geolocation").getCurrentPosition(function(a){d=[a.latitude,a.longitude]}):d=[80,80];return d};e.fn.MapMe.setMarkers=function(d, a){var c=a.markers,b=[];if(c.length>0)for(var g=0;g<c.length;g++){var f=c[g],h=c[g][4];if(c[g][3])f=e.fn.MapMe.customPin(d,a,f);else var i=new google.maps.LatLng(f[1],f[2]),f=new google.maps.Marker({position:i,map:d,title:f[0]});h&&e.fn.MapMe.addInfoWindow(d,a,f,h);b.push(f)}a.pinCenter==!0&&(a.centerMarker[3]?c=e.fn.MapMe.customPin(d,a,a.centerMarker):(c=new google.maps.Marker({position:a.mapOptions.center,title:a.centerMarker[0],map:d}),c.setMap(d)),(h=a.centerMarker[4])&&e.fn.MapMe.addInfoWindow(d, a,c,h),b.push(c));return b};e.fn.MapMe.customPin=function(d,a,c){var b=c[3];a.customPins[b]||alert("custom pin has not been defined properly");var e=new google.maps.MarkerImage(a.customPins[b].pinImg,new google.maps.Size(a.customPins[b].pinImgSize[0],a.customPins[b].pinImgSize[1]),new google.maps.Point(a.customPins[b].pinOrigin[0],a.customPins[b].pinOrigin[1]),new google.maps.Point(a.customPins[b].pinAnchor[0],a.customPins[b].pinAnchor[1])),f=new google.maps.MarkerImage(a.customPins[b].pinShadow, new google.maps.Size(a.customPins[b].pinShadowSize[0],a.customPins[b].pinShadowSize[1]),new google.maps.Point(a.customPins[b].pinShadowOrigin[0],a.customPins[b].pinShadowOrigin[1]),new google.maps.Point(a.customPins[b].pinShadowAnchor[0],a.customPins[b].pinShadowAnchor[1]));(a=a.customPins[b].pinShape)||(a="");b=new google.maps.LatLng(c[1],c[2]);return new google.maps.Marker({position:b,map:d,shadow:f,icon:e,shape:a,title:c[0]})};e.fn.MapMe.addInfoWindow=function(d,a,c,b){b=new google.maps.InfoWindow({content:b}); google.maps.event.addListener(c,"click",function(){b.open(d,c)})}})(jQuery);